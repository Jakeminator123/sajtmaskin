================================================================================
                    PROJECT TAKEOVER - DOKUMENTATION
                         Sajtmaskin Feature
================================================================================

√ñVERSIKT
--------
Project Takeover g√∂r att anv√§ndare kan "ta √∂ver" sina v0-genererade projekt
och redigera dem med en OpenAI Agent ist√§llet f√∂r v0 API.

Tv√• l√§gen finns:
1. SIMPLE (Redis) - Default, ingen GitHub kr√§vs
2. GITHUB - Full √§gandeskap, f√∂r utvecklare


================================================================================
                              SIMPLE MODE (Redis)
================================================================================

M√•lgrupp: Nyb√∂rjare, amat√∂rer, snabba anv√§ndare

Fl√∂de:
1. Anv√§ndare klickar "Ta √∂ver projekt" i builder
2. V√§ljer "Snabb & Enkel" (default)
3. Klickar "Ta √∂ver nu"
4. Filer sparas i Redis Cloud
5. Kan direkt b√∂rja redigera med AI

F√∂rdelar:
‚úÖ Inget GitHub-konto kr√§vs
‚úÖ Tar ~2 sekunder
‚úÖ Kan ladda ner ZIP n√§r som helst
‚úÖ AI-redigering fungerar direkt

Nackdelar:
‚ùå Ingen versionshistorik
‚ùå Data har 30 dagars TTL i Redis


================================================================================
                              GITHUB MODE
================================================================================

M√•lgrupp: Utvecklare som vill ha full kontroll

Fl√∂de:
1. Anv√§ndare klickar "Ta √∂ver projekt" i builder
2. V√§ljer "Pusha till GitHub"
3. Ansluter GitHub-konto (OAuth) om inte redan gjort
4. Anger valfritt repo-namn
5. Klickar "Pusha till GitHub"
6. Privat repo skapas p√• anv√§ndarens GitHub
7. Alla filer pushas dit
8. Kopia sparas i Redis f√∂r snabb AI-redigering

F√∂rdelar:
‚úÖ Anv√§ndaren √§ger 100% av koden
‚úÖ Full versionshistorik
‚úÖ Kan klona lokalt
‚úÖ Kan deploya var som helst
‚úÖ Kan samarbeta med andra

Nackdelar:
‚ùå Kr√§ver GitHub-konto
‚ùå Tar ~10-20 sekunder


================================================================================
                              TEKNISK ARKITEKTUR
================================================================================

API Routes:
-----------
POST /api/projects/[id]/takeover
  Body: { mode: "redis" | "github", repoName?: string }
  
  Redis mode:
    ‚Üí H√§mtar filer fr√•n projectData
    ‚Üí Sparar i Redis (saveProjectFiles)
    ‚Üí Sparar metadata (saveProjectMeta)
    ‚Üí Returnerar success
    
  GitHub mode:
    ‚Üí H√§mtar filer fr√•n projectData
    ‚Üí Skapar GitHub repo via API
    ‚Üí Pushar alla filer (blobs ‚Üí tree ‚Üí commit ‚Üí ref)
    ‚Üí Sparar kopia i Redis
    ‚Üí Sparar metadata
    ‚Üí Returnerar repo URL

POST /api/agent/edit
  Body: { projectId: string, instruction: string, previousResponseId?: string }
  
  ‚Üí H√§mtar projektmetadata fr√•n Redis
  ‚Üí Skapar AgentContext (auto-detect storage type)
  ‚Üí K√∂r OpenAI Responses API med tools
  ‚Üí Uppdaterar filer i Redis (och GitHub om github-mode)
  ‚Üí Returnerar √§ndringar och agent-svar


Redis Funktioner (lib/redis.ts):
--------------------------------
saveProjectFiles(projectId, files)    - Spara alla filer
getProjectFiles(projectId)            - H√§mta alla filer
updateProjectFile(projectId, path, content) - Uppdatera en fil
deleteProjectFile(projectId, path)    - Ta bort en fil
saveProjectMeta(meta)                 - Spara metadata
getProjectMeta(projectId)             - H√§mta metadata
listUserTakenOverProjects(userId)     - Lista anv√§ndarens projekt

Redis Keys:
  project:files:{projectId}  ‚Üí JSON array av filer
  project:meta:{projectId}   ‚Üí JSON metadata objekt
  TTL: 30 dagar


OpenAI Agent (lib/openai-agent.ts):
-----------------------------------
Tools:
  - read_file(path)                    ‚Üí L√§s fil fr√•n Redis/GitHub
  - update_file(path, content, msg)    ‚Üí Uppdatera fil
  - list_files(path?)                  ‚Üí Lista alla filer

Modell: gpt-4.1
API: OpenAI Responses API (med function calling)
Stateful: Ja (previous_response_id f√∂r multi-turn)


================================================================================
                              FRONTEND KOMPONENTER
================================================================================

TakeoverModal (components/takeover-modal.tsx):
----------------------------------------------
- Visar tv√• alternativ: Simple / GitHub
- Hanterar GitHub OAuth-anslutning
- Visar progress och resultat
- Anpassad f√∂r b√•de nyb√∂rjare och utvecklare

ProjectEditorPage (app/project/[repoId]/page.tsx):
--------------------------------------------------
- Editor-vy f√∂r √∂vertagna projekt
- Chat-interface f√∂r AI-instruktioner
- Visar fil-lista
- Kostar 1 üíé per redigering


================================================================================
                              DATAMODELLER
================================================================================

ProjectFile:
{
  path: string;        // "src/app/page.tsx"
  content: string;     // Filinneh√•ll
  lastModified?: string; // ISO timestamp
}

ProjectMeta:
{
  projectId: string;
  userId: string;
  name: string;
  takenOverAt: string; // ISO timestamp
  storageType: "redis" | "github";
  githubRepo?: string;
  githubOwner?: string;
  filesCount: number;
}

AgentContext:
{
  projectId: string;
  storageType: "redis" | "github";
  githubToken?: string;
  repoFullName?: string;
  previousResponseId?: string;
}


================================================================================
                              MILJ√ñVARIABLER
================================================================================

Kr√§vs f√∂r GitHub OAuth:
  GITHUB_CLIENT_ID=xxx
  GITHUB_CLIENT_SECRET=xxx
  NEXT_PUBLIC_BASE_URL=https://sajtmaskin-1.onrender.com

Kr√§vs f√∂r Redis:
  REDIS_HOST=redis-12352.fcrce259.eu-central-1-3.ec2.cloud.redislabs.com
  REDIS_PORT=12352
  REDIS_USERNAME=default
  REDIS_PASSWORD=xxx

Kr√§vs f√∂r OpenAI Agent:
  OPENAI_API_KEY=sk-xxx


================================================================================
                              KOSTNAD
================================================================================

Takeover: GRATIS
AI-redigering: 1 üíé (diamant) per instruktion

Test-anv√§ndare (test@gmail.com) har obegr√§nsade diamanter.


================================================================================
                              FRAMTIDA F√ñRB√ÑTTRINGAR
================================================================================

[ ] Webhook f√∂r att synka GitHub ‚Üí Redis vid externa √§ndringar
[ ] "Mina √∂vertagna projekt" - dedikerad lista-vy
[ ] Deploy-integration (Vercel, Netlify)
[ ] Collaboration - bjud in andra att redigera
[ ] Bildgenerering via AI_BILD_OCH_VID_2.py
[ ] Undo/redo f√∂r AI-√§ndringar


================================================================================
                              FILER I DENNA IMPLEMENTATION
================================================================================

Backend:
  app/src/app/api/auth/github/route.ts          - Start GitHub OAuth
  app/src/app/api/auth/github/callback/route.ts - Handle OAuth callback
  app/src/app/api/projects/[id]/takeover/route.ts - Takeover endpoint
  app/src/app/api/agent/edit/route.ts           - AI edit endpoint
  app/src/lib/openai-agent.ts                   - OpenAI agent logic
  app/src/lib/redis.ts                          - Redis storage functions
  app/src/lib/database.ts                       - SQLite + GitHub columns

Frontend:
  app/src/components/takeover-modal.tsx         - Takeover UI modal
  app/src/app/project/[repoId]/page.tsx         - Project editor page
  app/src/app/builder/page.tsx                  - "Ta √∂ver" button
  app/src/lib/auth-store.ts                     - GitHub status in state


================================================================================
                              GIT BRANCH
================================================================================

Branch: tresteg
Status: Ready for testing/merge

Commits:
- feat: Add Project Takeover + OpenAI Agent editing
- fix: Prevent double message execution in chat panel
- feat: Add two takeover modes - Simple (Redis) and GitHub
- fix: Add id/name attributes to form inputs for accessibility


================================================================================
                    Senast uppdaterad: 2025-12-04
================================================================================

