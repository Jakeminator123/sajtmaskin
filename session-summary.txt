Session summary - 2026-01-28

Scope
- Builder UI (chat left, preview center, versions right)
- v0 chat creation + streaming
- shadcn/ui registry blocks
- MCP docs downloader

Changes implemented
1) Duplicate chat creation guard
   - Session lock + in-flight ref to stop double creation on reload/quick actions.
   - Lock updated when chatId arrives in stream "chatId" and "done", and on non-stream responses.
   - Attachment signature normalized and URL-encoded to avoid key collisions.

2) Post-check tool output + summary
   - After each version, fetch files and diff vs previous version.
   - Adds tool output with added/modified/removed file lists.
   - Warns on suspicious React use() usage and missing preview link.
   - Adds a short summary in chat when natural (not during integration prompts).

3) shadcn/ui registry hardening + naming
   - Fetch registry index and filter blocks to available ones.
   - Surface JSON parse errors instead of silently hiding.
   - UI text changed from "Design System" to "shadcn/ui".

4) MCP docs downloader (doc.py)
   - Added output_format support and --txt handling for auto + interactive mode.
   - Writes content to md/ or txt/ with matching combined output.

5) Repo hygiene
   - Ignore mcp-monitoring-report.txt in .gitignore.

Bugs fixed (confirmed)
- Missing lock update on stream "done" chatId.
- Missing lock update on non-stream chatId.
- Attachment signature collisions due to unescaped "|" and empty identifiers.
- Registry JSON parse errors being swallowed.
- shadcn registry 404s from unavailable blocks.
- doc.py --txt ignored in interactive mode.
- Missing change summary when tool output was absent.

Known issues / revisit
- Generated demo pages still can crash with "use() passed [object Object]" in GamePage.
  This is in generated code, not the builder shell.
- Preview assets occasionally report wrong MIME/HTML or fail to load; investigate in Network.
- Cross-origin iframe selection ("specificera omrade") is still a separate task.

Suggested next steps
1) Run a fresh generation and confirm:
   - Post-check tool output appears.
   - Summary appears in chat when not a question or integration prompt.
   - No duplicate chat creation on reload.
2) If the GamePage error repeats, download the generated version and patch use().
3) Optional: add a server-side lint/TS check for generated code (slower but stronger).
4) If needed, prototype "specificera omrade" overlay for placement selection.

What looks good
- Dedup guard is active without removing existing functionality.
- Registry block picker now reflects actual registry content.
- Post-check provides real changes + preview warnings.

