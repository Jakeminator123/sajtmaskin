Buggrapport – installation/entry till V0 (första prompt + följdprompter)
Datum: 2026-02-01

Källa:
- Kodgranskning i repo
- Lokal dokumentation: LLM/v0-prompt-guide.txt
- MCP: inga resurser hittades via ListMcpResources

============================================================
Strukturellt exempel (happy path)
============================================================
Entry → Builder → V0 (första prompt)
1) UI entry:
   - / (home page) → prompt i PromptInput
   - /category/[type] → prompt + project skapad
2) Builder tar emot prompt:
   - /builder?promptId=... eller /builder?prompt=...
   - resolvedPrompt → ChatInterface initialPrompt (prefill i input)
3) Skick till V0:
   - ChatInterface submit → useV0ChatMessaging.createNewChat()
   - POST /api/v0/chats/stream → v0.chats.create(responseMode=experimental_stream)
   - SSE tillbaka → chat + version sparas i DB

Följdprompter (refinement)
1) ChatInterface submit → useV0ChatMessaging.sendMessage()
2) POST /api/v0/chats/{chatId}/stream → v0.chats.sendMessage()
3) SSE tillbaka → versions uppdateras i DB

Noterbara alternativa entry-flöden:
- Template: /builder?templateId=... → /api/template → v0-generator (v0 Platform API)
- Registry (shadcn): /api/v0/chats/init-registry → v0 Platform API
- Audit: /builder?source=audit&auditId=... → prompt hämtas från storage

============================================================
Buggar / risker (skala 0-100)
============================================================
Skala:
- Påverkan: sannolik effekt om buggen inträffar (0-100)
- Buggsannolikhet: hur troligt att detta är en faktisk bugg (0-100)

1) Första prompten skickas inte automatiskt till V0
   - Beskrivning: initialPrompt prefylls i ChatInterface, men ingen auto-submit sker.
   - Konsekvens: användaren måste manuellt klicka “skicka” för att V0 ska köras.
   - Påverkan: 70
   - Buggsannolikhet: 75
   - Relevanta filer: src/components/builder/ChatInterface.tsx, src/app/builder/page.tsx

2) Onboarding-data används inte i första prompten
   - Beskrivning: getInitialContext() bygger text men används bara för visning.
   - Konsekvens: kontext från onboarding går inte med in i V0 utan manuell kopiering.
   - Påverkan: 45
   - Buggsannolikhet: 60
   - Relevanta filer: src/components/layout/home-page.tsx

3) Inkonsekvent promptöverföring (URL vs storage) kan tappa prompt
   - Beskrivning: category-flöden använder prompt i URL, inte storage.
   - Konsekvens: långa prompts kan trunkeras av URL-limit → fel eller tom prompt.
   - Påverkan: 55
   - Buggsannolikhet: 60
   - Relevanta filer: src/app/category/[type]/page.tsx, src/app/builder/page.tsx

4) Template-init blockas av auditPromptLoaded
   - Beskrivning: template-init körs bara när auditPromptLoaded=true.
   - Konsekvens: vid source=audit + templateId eller fel i audit storage kan template-init aldrig starta.
   - Påverkan: 50
   - Buggsannolikhet: 35
   - Relevanta filer: src/app/builder/page.tsx

5) Fri prompt cleanup saknas (promptId lagras men rensas ej)
   - Beskrivning: promptId-data rensas inte efter användning.
   - Konsekvens: stale data i storage, risk för förväxling vid edge-cases.
   - Påverkan: 20
   - Buggsannolikhet: 40
   - Relevanta filer: src/app/builder/page.tsx, src/components/layout/home-page.tsx

6) Projekt skapas före V0-chat i category-flöden
   - Beskrivning: project skapas, sen navigeras till builder där chat skapas.
   - Konsekvens: om V0-call misslyckas blir projektet kvar utan chat.
   - Påverkan: 30
   - Buggsannolikhet: 45
   - Relevanta filer: src/app/category/[type]/page.tsx

============================================================
V0-agentens capabilities / paket (Shadcn)
============================================================
Bedömning:
- Shadcn/ui är explicit rekommenderat i standardinstruktionerna och prompt assist.
- Shadcn-registry integration finns för block.
- Inga hårda allow/deny-listor för npm-paket.

Risker:
1) Inga dependency-checks efter V0-generering
   - V0 kan generera kod som kräver paket som inte installeras.
   - Sannolik effekt: deploy/build fel om paket saknas.

2) Shadcn antas finnas
   - Prompter antar att shadcn/ui primitives finns, men verifieras inte.
   - Risk: saknade komponenter om registry-block kräver nya primitives.

Relevanta filer:
- src/lib/builder/defaults.ts
- src/lib/builder/promptAssist.ts
- src/lib/shadcn-registry-utils.ts
- src/lib/shadcn-registry-service.ts
- LLM/v0-prompt-guide.txt

============================================================
Snabb slutsats
============================================================
Flödet till V0 finns och fungerar, men första prompten skickas inte automatiskt i någon entry-path.
Detta är den mest sannolika orsaken till att “oavsett hur de kommer dit” inte uppfylls.
De största praktiska riskerna ligger i promptöverföring via URL samt audit/template-gating.
